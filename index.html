<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vístete sin Drama</title>
  <meta name="description" content="Tienda de ropa y accesorios en estilo pixel. Vístete sin Drama.">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="logo-container">
      <img src="logo.png" alt="Logo de Vístete sin Drama" class="logo-pixel" onerror="this.src='https://i.ibb.co/8rQjzHD/camiseta-pixel.png';" aria-hidden="true" />
    </div>
    <h1>
      <span class="pixel-anim">Vístete sin Drama</span>
    </h1>
    <nav>
      <button class="pixel-btn-nav activo" onclick="activarNav(this);mostrarVista('productos')" aria-current="page">Productos</button>
      <button class="pixel-btn-nav" onclick="activarNav(this);mostrarVista('favoritos')">Favoritos <span id="favoritos-contador" class="favoritos-badge" aria-label="Productos favoritos" aria-live="polite"></span></button>
      <button class="pixel-btn-nav" onclick="activarNav(this);mostrarVista('admin')">Admin</button>
    </nav>
  </header>
  <main>
    <section id="vista-productos">
      <h2 class="pixel-title">Productos Disponibles</h2>
      <div id="productos" class="pixel-grid"></div>
    </section>
    <section id="vista-favoritos" class="oculto">
      <h2 class="pixel-title">Tus Favoritos</h2>
      <div id="favoritos-lista" class="pixel-grid"></div>
      <p id="sin-favoritos" style="margin:2em 0 0 0; color:#b7bdf8; text-align:center; display:none;">No tienes productos favoritos aún.</p>
    </section>
    <section id="vista-admin" class="oculto">
      <h2 class="pixel-title">Modo Administrador</h2>
      <div id="admin-login">
        <label for="admin-pass" class="sr-only">Contraseña admin</label>
        <input class="pixel-input" type="password" placeholder="Contraseña admin" id="admin-pass">
        <button class="pixel-btn" onclick="loginAdmin()">Entrar</button>
        <p id="admin-error" class="pixel-error"></p>
      </div>
      <div id="admin-panel" style="display:none;">
        <p id="admin-bienvenida" class="pixel-bienvenida" style="margin-bottom: 1em;"></p>
        <button class="pixel-btn" onclick="logoutAdmin()" style="margin-bottom:1em;">Cerrar sesión</button>
        <h3 class="pixel-title">Agregar productos</h3>
        <div id="contenedor-formularios"></div>
        <button class="pixel-btn" onclick="agregarFormularioProducto()">+ Agregar producto</button>
      </div>
    </section>
  </main>
  <footer>
    <p>&copy; 2025 Vístete sin Drama · Pixel Style</p>
  </footer>
  <a href="https://chat.whatsapp.com/CgBg5eIDrXs67N2DwdVePl" target="_blank" rel="noopener noreferrer" class="whatsapp-float" title="Unirse al grupo de WhatsApp" aria-label="Unirse al grupo de WhatsApp">
    <img src="whatsapp.svg" alt="" aria-hidden="true" class="whatsapp-icon">
    <span class="whatsapp-text">Unirse WhatsApp</span>
  </a>
  <script src="app.js"></script>
  <script>
  function agregarFormularioProducto() {
    const contenedor = document.getElementById("contenedor-formularios");
    const div = document.createElement("div");
    div.className = "formulario-producto";
    div.innerHTML = `
      <input class="pixel-input" type="text" placeholder="Nombre" autocomplete="off">
      <input class="pixel-input" type="text" placeholder="Descripción" autocomplete="off">
      <input class="pixel-input" type="number" placeholder="Precio (S/)" min="1">
      <input class="pixel-input" type="file" accept="image/*">
      <select class="pixel-input">
        <option value="">Categoría...</option>
        <option value="Ropa">Ropa</option>
        <option value="Accesorios">Accesorios</option>
        <option value="Calzado">Calzado</option>
        <option value="Otro">Otro</option>
      </select>
      <button class="pixel-btn" type="button">Guardar producto</button>
      <hr style="margin:1em 0;">
    `;
    const btnGuardar = div.querySelector("button");
    btnGuardar.onclick = function() {
      guardarEsteProducto(div, btnGuardar);
    };
    contenedor.appendChild(div);
  }

  function autoFormularioAdmin() {
    const contenedor = document.getElementById("contenedor-formularios");
    contenedor.innerHTML = '';
    agregarFormularioProducto();
  }

  function guardarEsteProducto(div, btn) {
    const inputs = div.querySelectorAll(".pixel-input");
    const nombre = inputs[0].value.trim();
    const descripcion = inputs[1].value.trim();
    const precio = parseFloat(inputs[2].value.trim());
    const imagenInput = inputs[3];
    const imagenFile = imagenInput.files[0];
    const categoria = inputs[4].value.trim();

    // Validación tamaño máximo de imagen (120 KB)
    if (imagenFile && imagenFile.size > 120 * 1024) {
      alert("La imagen es demasiado grande. Usa una imagen menor a 120 KB.");
      btn.disabled = false;
      btn.textContent = "Guardar producto";
      return;
    }

    if (!nombre || !descripcion || isNaN(precio) || !imagenFile || !categoria) {
      alert("Completa todos los campos correctamente.");
      return;
    }

    btn.disabled = true;
    btn.textContent = "Guardando...";

    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const imagen = e.target.result;
        const productos = obtenerProductos();
        const nuevo = {
          id: crypto.randomUUID(),
          nombre,
          descripcion,
          precio,
          imagen,
          categoria
        };
        productos.unshift(nuevo);
        guardarProductos(productos);

        mostrarProductos();
        if (typeof mostrarFavoritos === "function") mostrarFavoritos();
        mostrarMensajeExito("Producto agregado exitosamente.");

        div.remove();
        agregarFormularioProducto();
      } catch (err) {
        alert("Error al guardar el producto: " + err.message);
        btn.disabled = false;
        btn.textContent = "Guardar producto";
      }
    };
    reader.onerror = function() {
      alert("Error leyendo la imagen. Intenta con otra imagen o revisa el archivo.");
      btn.disabled = false;
      btn.textContent = "Guardar producto";
    };
    reader.readAsDataURL(imagenFile);
  }

  function mostrarVista(vista) {
    document.getElementById('vista-productos').classList.add('oculto');
    document.getElementById('vista-favoritos').classList.add('oculto');
    document.getElementById('vista-admin').classList.add('oculto');
    if(vista === 'productos') document.getElementById('vista-productos').classList.remove('oculto');
    if(vista === 'favoritos') document.getElementById('vista-favoritos').classList.remove('oculto');
    if(vista === 'admin') {
      document.getElementById('vista-admin').classList.remove('oculto');
      autoFormularioAdmin();
    }
  }
  </script>
</body>
</html>